<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" >
    <script>
        L_NO_TOUCH = false;
        L_DISABLE_3D = false;
    </script>
    <style>
        html, body { width: 100%; height: 100%; margin: 0; padding: 0; }
        #map { position: absolute; top: 0; bottom: 0; right: 0; left: 0; }
        #info-box {
            position: fixed;
            bottom: 10px;
            right: 10px;
            background: rgba(255, 255, 255, 0.9);
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            font-size: 14px;
            width: 250px;
            max-height: 300px;
            overflow-y: auto;
        }
        #info-box h5 { margin: 0; }
        #info-box ul { list-style-type: none; padding: 0; }
        #info-box li { margin: 5px 0; }
    </style>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.css">
    <script src="https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.js"></script>
</head>
<body>
    <div id="map"></div>
    <div id="info-box">
        <h5>情報</h5>
        <ul id="info-list"></ul>
    </div>

    <script>
        var map = L.map('map', {
            center: [35.5, 139.8],
            zoom: 10,
            zoomControl: true
        });

        var tileLayer = L.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png", {
            attribution: '© OpenStreetMap contributors'
        }).addTo(map);

        // 自分の位置を示す赤いピンアイコンURLを修正
        const pinIcon = L.icon({
            iconUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png', // 通常のピンURL
            iconSize: [25, 41], // ピンの大きさ
            iconAnchor: [12, 41], // ピンの基準点
            popupAnchor: [1, -34] // ポップアップ位置
        });
        
        // GPS情報を取得して自分の位置を表示
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function(position) {
                // GPSから取得した位置情報
                var userLat = position.coords.latitude;
                var userLng = position.coords.longitude;

                // 地図の中心を自分の位置に設定
                map.setView([userLat, userLng], 14);

                // 自分の位置を青いマーカーで表示
                var userMarker = L.marker([userLat, userLng], {
                    icon: L.icon({
                        iconUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-blue.png', // 青いピンのURL
                        iconSize: [25, 41],
                        iconAnchor: [12, 41],
                        popupAnchor: [1, -34]
                    })
                }).addTo(map);

                // 自分の位置を中心とした半径2000mの円を描画
                var circle = L.circle([userLat, userLng], {
                    color: 'blue',
                    fillColor: 'blue',
                    fillOpacity: 0.3,
                    radius: 2000 // 半径2000m
                }).addTo(map);
            }, function(error) {
                console.error("位置情報の取得に失敗しました:", error);
            });
        } else {
            alert("このブラウザでは位置情報の取得がサポートされていません。");
        }
        
        // JSONデータから読み込んだ既存のピンと多角形
        // JSONファイルからピンを追加するコード
        fetch('suirotuuhou.json') // JSONファイルのパスを指定
            .then(response => response.json())
            .then(data => {
                console.log("ピンデータ:", data); // デバッグ用ログ
                data.features.forEach(feature => {
                    const geometry = feature.geometry;
                    const attributes = feature.attributes;

                    // 緯度と経度を取得
                    const lat = geometry.y;
                    const lng = geometry.x;

                    // name の最右単語を取得
                    const nameParts = attributes.name.split(/[\s　、,、\-]+/); // スペースで分割
                    const lastWord = nameParts[nameParts.length - 1]; // 最右単語

                    // 赤いピンを地図に追加
                    const marker = L.marker([lat, lng], { icon: pinIcon }).addTo(map);

                    // ピンにポップアップを追加
                    marker.bindPopup(lastWord);
                });
            })
            .catch(error => {
                console.error("JSONデータの読み込みに失敗しました:", error);
            });

        // JSONファイルから多角形を追加するコード
        fetch('polygons.json') // JSONファイルのパスを指定
            .then(response => response.json())
            .then(data => {
                console.log("ポリゴンデータ:", data); // デバッグ用ログ
                // 各ポリゴンデータを処理
                data.forEach(polygon => {
                    const coordinates = polygon.coordinates.map(coord => [coord[0], coord[1]]); // [緯度, 経度] の形式に変換
                    const popupText = polygon.popup; // ポップアップ内容

                    // 多角形を地図に追加
                    const polygonLayer = L.polygon(coordinates, {
                        color: polygon.color || 'red', // デフォルトで赤色
                        fillColor: polygon.color || 'red', // 塗りつぶしも赤色
                        fillOpacity: polygon.fill_opacity || 0.3, // 半透明
                        weight: 2 // 線の太さ
                    }).addTo(map);

                    // ポリゴンにポップアップをバインド
                    polygonLayer.bindPopup(popupText);
                });
            })
            .catch(error => {
                console.error("JSONデータの読み込みに失敗しました:", error);
            });

        else {
            alert("位置情報が取得できません");
        }
            
            var tile_layer_245df3c1bcc4aaa2a808ac24a2743e2d = L.tileLayer(
                "https://tile.openstreetmap.org/{z}/{x}/{y}.png",
                {"attribution": "\u0026copy; \u003ca href=\"https://www.openstreetmap.org/copyright\"\u003eOpenStreetMap\u003c/a\u003e contributors", "detectRetina": false, "maxNativeZoom": 19, "maxZoom": 19, "minZoom": 0, "noWrap": false, "opacity": 1, "subdomains": "abc", "tms": false}
            );
        
    
            tile_layer_245df3c1bcc4aaa2a808ac24a2743e2d.addTo(map_       polygon_8cf5dc982d1cac870b1027e9990c164d.bindPopup(popup_fcfd5e6ecdfa355f6100170f860cd576)
        ;
        
    
</script>
</html>
